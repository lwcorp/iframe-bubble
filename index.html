<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat Balloon with Outside Close Icons & Slide Animation</title>
  <style>
    /* Merged Chat Balloon styles */
    .chat-balloon {
      position: fixed;
      bottom: 20px;
      width: 60px;
      height: 60px;
      cursor: pointer;
      z-index: 1000;
    }
    .chat-balloon svg {
      width: 100%;
      height: auto;
      border-radius: 50%;
    }
    .chat-balloon.he {
      right: 20px;
    }
    .chat-balloon.en {
      left: 20px;
    }
    
    /* Merged Chat Modal styles */
    .chat-modal {
      position: fixed;
      bottom: 20px;
      /* width: 400px; */
      background: #fff;
      z-index: 1001;
      border-radius: 5px;
      overflow: visible;
      opacity: 0;
      pointer-events: none;
      transform: translateY(100%);
      transition: transform 0.5s ease, opacity 0.5s ease;
    }
    .chat-modal.active {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }
    /* Specific language overrides */
    .chat-modal.he {
      /* height: 70%; */
      right: 20px;
      box-shadow: -2px 0 4px rgba(0, 0, 0, 0.3);
    }
    .chat-modal.en {
      /* height: 85%; */
      left: 20px;
      box-shadow: 2px 0 4px rgba(0, 0, 0, 0.3);
    }
    
    /* Common Close Button Style for both chats */
    .chat-modal-close {
      position: absolute;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 50%;
      font-size: 1.5em;
      cursor: pointer;
      color: #333;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      z-index: 1002;
    }

    /* Hebrew: Use .chat-modal-close.he for the unique positioning */
    .chat-modal-close.he {
      top: -15px;
      left: -25px;
    }

    /* English: Use .chat-modal-close.en for positioning on the right */
    .chat-modal-close.en {
      top: -25px;
      right: -25px;
    }

    /* Dark Mode for both */
    @media (prefers-color-scheme: dark) {
      .chat-modal-close {
        background: #333;
        border: 1px solid #404040;
        color: #fff;
      }
    }
    </style>
	
	<style>
	/* Just for the demo - Start */
    body {
      margin-top: 3%;
      margin-left: 10%;
	  font-size: 1.1em;
    }
	textarea {width: 100%; height:60px;}
	select {width: 50%;}
	.bold {font-weight: bold;}
    @media (max-width: 768px) {
      body {
        padding-top: 10%;
        padding-left: 15%;
      }
    }
    @media (prefers-color-scheme: dark) {
      body {
        background: black;
        color: white;
      }
	  a:link {color: lightblue;}
    }
  </style>
</head>
<body>
  <!-- Sample page content -->
  <h1>Sample page</h1>
  <p>
    This is sample page with a sample iframe.<br>
    You can either edit it or just test it live (per <a href="https://github.com/lwcorp/iframe-bubble#usage" target="_blank">usage</a>) by changing the following <span class="bold">live</span>:
  </p>
  <form oninput="this.requestSubmit()" onchange="this.requestSubmit()" onclick="this.requestSubmit()" onsubmit="genChatballon(); return false;">
    <table border=1>
	<tr>
	<td>Your LTR language iframe code</td>
	<td colspan="4"><textarea name="iframe_ltr"><iframe srcdoc="<style>body {margin-top: 40%; margin-left: 40%;}</style>This is a sample iframe" width="768px" height="710px" frameBorder="0" allowFullScreen></iframe></textarea></td>
	</tr>
	<tr>
	<td>Your RTL language iframe code</td>
	<td colspan="4"><textarea name="iframe_rtl"><iframe srcdoc="<style>body {direction: rtl;margin-top: 40%; margin-right: 40%;}</style>דוגמא ל-iframe" width="768px" height="710px" frameBorder="0" allowFullScreen></iframe></textarea></td>
	</tr>
	<tr>
	<td>Use <code>dualchat</code></td>
	<td><input name="dualchat" type="checkbox"></td>
	</tr>
	<tr>
	<td>Limit <code>chatlang</code></td>
	<td><input name="chatlang_all" type="checkbox" value="all" checked onclick="form.chatlang_template.disabled = this.checked; form.chatlang.value = this.checked ? this.value : Array.from(form.chatlang_template.selectedOptions).map(option => option.value).join(',');">All</td>
	<td>Select manually (multiple choice)
	<br /><select name="chatlang_template" multiple disabled onchange="form.chatlang.value = this.readOnly ? form.chantlang_all.value : Array.from(this.selectedOptions).map(option => option.value).join(',')">
			<option value="en" selected>en</option>
			<option value="he" selected>he</option>
		</select>
	<td>Preview</td>
	<td><input name="chatlang" type="text" disabled value="all"></td>
	</tr>
	</table>	
  </form>
  <p>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
    Sample line<br>
  </p>
  
  <!-- Floating Chat Balloon for Hebrew Chat -->
  <div id="chat-balloon" class="chat-balloon he">
    <svg width="60" height="60" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="textShadow" x="-10%" y="-10%" width="120%" height="120%">
          <feDropShadow dx="0.5" dy="0.5" stdDeviation="0.5" flood-color="#000" flood-opacity="0.3"/>
        </filter>
      </defs>
      <path fill="#ff9900" stroke="#ff6600" stroke-width="4" d="
        M8,8 
        h40 
        a4,4 0 0 1 4,4 
        v24 
        a4,4 0 0 1 -4,4 
        h-10 
        l-8,8 
        l-8,-8 
        h-10 
        a4,4 0 0 1 -4,-4 
        v-24 
        a4,4 0 0 1 4,-4 
        z"/>
      <text x="45%" y="48%" text-anchor="middle" fill="#003366" font-size="0.8em" font-weight="bold" font-family="'Arial Hebrew', 'Noto Sans Hebrew', sans-serif" filter="url(#textShadow)">HE</text>
    </svg>
  </div>
  
  <!-- Modal Overlay for the Hebrew iFrame -->
  <div id="chat-modal" class="chat-modal he">
    <!-- Close icon placed outside the scrollable content -->
    <span class="chat-modal-close he">&times;</span>
    <div id="chat-modal-content">
      <!-- The iframe will be injected here on click -->
      <div id="iframe-container"></div>
      <textarea id="iframe-markup" style="display:none;">
        <!-- You can write here directly your RTL language <iframe code -->
      </textarea>
    </div>
  </div>
  
  <!-- Floating Chat Balloon for English Chat -->
  <div id="chat-balloon-en" class="chat-balloon en">
    <svg width="60" height="60" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="textShadowEn" x="-10%" y="-10%" width="120%" height="120%">
          <feDropShadow dx="0.5" dy="0.5" stdDeviation="0.5" flood-color="#000" flood-opacity="0.3"/>
        </filter>
      </defs>
      <path fill="#ff9900" stroke="#ff6600" stroke-width="4" d="
        M8,8 
        h40 
        a4,4 0 0 1 4,4 
        v24 
        a4,4 0 0 1 -4,4 
        h-10 
        l-8,8 
        l-8,-8 
        h-10 
        a4,4 0 0 1 -4,-4 
        v-24 
        a4,4 0 0 1 4,-4 
        z"/>
      <text x="45%" y="48%" text-anchor="middle" fill="#003366" font-size="0.8em" font-weight="bold" font-family="Arial, Helvetica, sans-serif" filter="url(#textShadowEn)">EN</text>
    </svg>
  </div>
  
  <!-- Modal Overlay for the English iFrame -->
  <div id="chat-modal-en" class="chat-modal en">
    <!-- Close icon placed outside the scrollable content -->
    <span class="chat-modal-close en">&times;</span>
    <div id="chat-modal-content-en">
      <!-- The iframe will be injected here on click -->
      <div id="iframe-container-en"></div>
      <textarea id="iframe-markup-en" style="display:none;">
        <!-- You can write here directly your LTR language <iframe code -->
      </textarea>
    </div>
  </div>
  
  <script>
    document.addEventListener("DOMContentLoaded", genChatballon());
	function genChatballon() {
	  // You can change the following - Start
      // Allow opening multiple bubbles simultaneously
      var dualchat_default = false;
      // Added chatlang parameter to control which chat bubbles appear
      var chatlang_default = 'en,he'; // Can be empty string, all, or comma-separated languages like en,he
	  // You can change the following - End
	  
	  // Determine settings
	  const dualchat = document.forms[0]?.dualchat?.checked || dualchat_default;
	  const chatlang = document.forms[0]?.chatlang?.value || chatlang_default;

      // Hebrew Chat listeners
      var chatBalloon = document.querySelector(".chat-balloon.he");
      var chatModal = document.querySelector(".chat-modal.he");
      var chatModalClose = document.querySelector(".chat-modal.he .chat-modal-close");
      var iframeContainer = document.getElementById("iframe-container");
	  const iframeMarkup = document.forms[0]?.iframe_rtl?.value || document.getElementById("iframe-markup").value.trim();
    
      // English Chat listeners
      var chatBalloonEn = document.querySelector(".chat-balloon.en");
      var chatModalEn = document.querySelector(".chat-modal.en");
      var chatModalCloseEn = document.querySelector(".chat-modal.en .chat-modal-close");
      var iframeContainerEn = document.getElementById("iframe-container-en");
	  const iframeMarkupEn = document.forms[0]?.iframe_ltr?.value || document.getElementById("iframe-markup-en").value.trim();
      
      // Function to control chat bubble visibility based on chatlang
      function updateChatBubbleVisibility() {
        // Hide all chat bubbles by default
        chatBalloon.style.display = 'none';
        chatBalloonEn.style.display = 'none';
        
        // If chatlang is empty, no bubbles should appear
        if (!chatlang) {
          return;
        }
        
        // If chatlang is 'all', show both bubbles
        if (chatlang === 'all') {
          chatBalloon.style.display = 'block';
          chatBalloonEn.style.display = 'block';
          return;
        }
        
        var languages = chatlang.replace(/\s+/g, '').split(',');
        
        if (languages.includes('he')) {
          chatBalloon.style.display = 'block';
        }
        
        if (languages.includes('en')) {
          chatBalloonEn.style.display = 'block';
        }
      }
      
      // Initialize chat bubble visibility
      updateChatBubbleVisibility();
	  
 	  chatBalloon.removeEventListener("click", parent.iframeOpenWrapper);
	  chatBalloonEn.removeEventListener("click", parent.iframeOpenWrapperEn);
	  chatModalClose.removeEventListener("click", parent.iframeCloseWrapper);
	  chatModalCloseEn.removeEventListener("click", parent.iframeCloseWrapperEn);

      parent.iframeOpenWrapper = function(e) {
	    iframeOpen(iframeContainer, iframeMarkup, chatModal, dualchat, '.chat-modal.en');
	  }
      parent.iframeOpenWrapperEn = function(e) {
  		iframeOpen(iframeContainerEn, iframeMarkupEn, chatModalEn, dualchat, '.chat-modal.he');
	  }
      parent.iframeCloseWrapper = function(e) {
		iframeClose(e, chatModal);
	  }
      parent.iframeCloseWrapperEn = function(e) {
	    iframeClose(e, chatModalEn);
	  }
	  
	  chatBalloon.addEventListener("click", parent.iframeOpenWrapper);
	  chatBalloonEn.addEventListener("click", parent.iframeOpenWrapperEn);
	  chatModalClose.addEventListener("click", parent.iframeCloseWrapper);
	  chatModalCloseEn.addEventListener("click", parent.iframeCloseWrapperEn);
	  
	  function iframeOpen(container, markup, modal, dualchat, elm) {
        container.innerHTML = markup;
        // If dualchat is false, close the previous chat modal before opening another chat one
        if (!dualchat) {
          document.querySelector(elm).classList.remove("active");
        }
        modal.classList.add("active");
      }
	  
	  function iframeClose(evt, elm) {
        evt.preventDefault();
        elm.classList.remove("active");
      }
    }
  </script>
</body>
</html>
